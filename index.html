<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <button
      onclick="window.location='favorites.html'"
      class="changeSites"
      id="showFavouritesButton"
    >
      favourites
    </button>
    <script>
      let length = 0;
      let id = 0;
      let isCat = true;

      function spawnPost() {
        const post = document.createElement("img");
        post.className = "post";
        post.id = "img_" + id;
        document.body.appendChild(post);

        const like = document.createElement("img");
        like.src =
          "https://cdn-icons-png.flaticon.com/512/833/833472.png?w=360";
        like.style.width = "60px";
        like.id = "like_" + id;
        like.style.cursor = "pointer";
        like.className = "like-button";
        let liked = false;
        like.onclick = function () {
          liked = !liked;
          if (liked) {
            like.classList.add("liked");

            var rawBody = JSON.stringify({
              image_id: like.getAttribute("data-image-id"),
            });
            const newFavourite = fetch(
              "https://api.thecatapi.com/v1/favourites",
              {
                method: "POST",
                headers: {
                  "x-api-key": "DEMO-API-KEY",
                  "Content-Type": "application/json",
                },
                body: rawBody,
              }
            );
          } else {
            like.classList.remove("liked");
          }

          //alert("You liked post #" + (id + 1));
        };
        like.style.position = "absolute";
        like.style.marginLeft = "min(calc(100vw - 70px), 430px)";
        like.style.marginTop = 100 * (id + 1) - 60 + "vh";
        document.body.appendChild(like);

        const currentId = id;
        if (isCat) {
          fetch("https://api.thecatapi.com/v1/images/search")
            .then((response) => response.json())
            .then((data) => {
              console.log("Cat API response:", data);
              if (data && data[0] && data[0].url) {
                document.getElementById("img_" + currentId).src = data[0].url;
                document
                  .getElementById("like_" + currentId)
                  .setAttribute("data-image-id", data[0].id);
              } else {
                document.getElementById("img_" + currentId).src =
                  "https://via.placeholder.com/500x300?text=No+Image";
              }
            })
            .catch((err) => {
              console.error("Cat API error:", err);
              document.getElementById("img_" + currentId).src =
                "https://via.placeholder.com/500x300?text=Error";
            });

          //isCat = false;
        } else {
          fetch("https://dog.ceo/api/breeds/image/random")
            .then((response) => response.json())
            .then((data) => {
              console.log("Dog API response:", data);
              if (data && data.message) {
                document.getElementById("img_" + currentId).src = data.message;
              } else {
                document.getElementById("img_" + currentId).src =
                  "https://via.placeholder.com/500x300?text=No+Image";
              }
            })
            .catch((err) => {
              console.error("Dog API error:", err);
              document.getElementById("img_" + currentId).src =
                "https://via.placeholder.com/500x300?text=Error";
            });

          isCat = true;
        }

        id += 1;
      }

      spawnPost();
      spawnPost();
      spawnPost();
      length = window.innerHeight;

      function checkScroll() {
        var scrollTop =
          window.pageYOffset !== undefined
            ? window.pageYOffset
            : (
                document.documentElement ||
                document.body.parentNode ||
                document.body
              ).scrollTop;

        console.log(scrollTop);

        if (scrollTop > length) {
          spawnPost();
          length += window.innerHeight;
        }
        requestAnimationFrame(checkScroll);
      }
      checkScroll();
    </script>
  </body>
</html>
